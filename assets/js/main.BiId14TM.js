const P=t=>{const e=document.body,s=document.querySelector(".header__burger"),n=document.querySelector(".header__center"),a=n.querySelectorAll(".header__nav a"),o=document.querySelector(".header__mobile-close");function r(){n.classList.add("header__center--active"),e.classList.add("body-active"),t.classList.add("overlay--active")}function c(){n.classList.remove("header__center--active"),e.classList.remove("body-active"),t.classList.remove("overlay--active")}s.addEventListener("click",()=>{r()}),o.addEventListener("click",()=>{c()}),t.addEventListener("click",()=>{c()}),a.forEach(i=>{i.addEventListener("click",()=>{c()})})},M=()=>{const t=document.querySelectorAll(".js-search-toggle"),e=document.querySelector(".header__search-bar"),s=document.querySelector(".header__search-input"),n=document.querySelector(".header__search-close");if(t.length===0||!e)return;function a(){t.forEach(r=>{r.classList.toggle("header__info-search--active")}),e.classList.toggle("header__search-bar--active")}function o(){t.forEach(r=>{r.classList.remove("header__info-search--active")}),e.classList.remove("header__search-bar--active"),s&&(s.value="")}t.forEach(r=>{r.addEventListener("click",c=>{c.preventDefault(),a(),setTimeout(()=>{s&&s.focus()},400)})}),n&&n.addEventListener("click",r=>{r.preventDefault(),o()})};function $(t){const e=document.querySelector(".archive-tabs__item--active"),s=document.querySelector(".archive-tabs");if(!e||!s||t.length===0)return;const n=t[0],a=t[t.length-1];s.classList.remove("has-active-first","has-active-last"),e===n?s.classList.add("has-active-first"):e===a&&s.classList.add("has-active-last")}function T(t,e){t.forEach(s=>s.classList.remove("archive-tabs__item--active")),e&&e.classList.add("archive-tabs__item--active"),$(t)}function L(t,e=0){t[e].classList.add("js-tabs-content--active")}function C(t){t.forEach(e=>{e.classList.remove("js-tabs-content--active")})}const D=(t,e,s)=>{const n=document.querySelector(t),a=document.querySelectorAll(e),o=document.querySelectorAll(s);o.length!==0&&L(o,0),n.addEventListener("click",i=>{i.preventDefault();const l=i.target;l&&l.classList.contains(e.substring(1))&&a.forEach((u,m)=>{if(l===u){if(T(a,a[m]),o.length===0)return;C(o),L(o,m)}})});let r=6;const c=7;r=7,c=8,console.log(r),console.log(c)},j=document.querySelector(".header");j.addEventListener("click",()=>{console.log(j)});const H=()=>{const t=document.querySelectorAll(".archive-tabs__item"),e={"О журнале":".info-section",Архив:".journal-section--archive",Реклама:".info-section--ads",Подписка:".info-section--subscribe"},s={about:"О журнале",archive:"Архив",ads:"Реклама",subscribe:"Подписка"},n={"О журнале":"about",Архив:"archive",Реклама:"ads",Подписка:"subscribe"},a=Object.values(e).map(c=>document.querySelector(c)),o=c=>{const i=Array.from(t).findIndex(l=>l.textContent.trim()===c);i!==-1&&(T(t,t[i]),C(a),a[i]&&L(a,i))};if(t.length>0){const i=new URLSearchParams(window.location.search).get("tab");i&&s[i]?(o(s[i]),setTimeout(()=>{const l=document.querySelector(".archive-tabs");l&&l.scrollIntoView({behavior:"smooth",block:"start"})},100)):a.forEach((l,u)=>{l&&u===0&&L(a,0)})}document.querySelectorAll(".footer__nav-list li a").forEach(c=>{const i=c.textContent.trim();if(n[i]){const l=`${window.location.origin}/about/?tab=${n[i]}`;c.setAttribute("href",l),c.addEventListener("click",u=>{if(u.ctrlKey||u.metaKey||u.shiftKey||u.button===1)return;const m=document.querySelector(".archive-tabs--journal");m&&t.length>0&&(u.preventDefault(),o(i),setTimeout(()=>{m.scrollIntoView({behavior:"smooth",block:"start"})},100))})}})},k=async(t,e)=>await(await fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e})).text(),v=document.querySelectorAll(".archive-tabs__item"),d=document.getElementById("news-container"),h=document.getElementById("news-loader");let q=1,x="all";const S=10,B=5;let p=!1,f=!0,E=null;function z(t=1,e=!1){if(p||!f&&e)return;p=!0,h&&(h.style.display="");const s=t===1?S:B;k(ajax_object.ajaxurl,`action=khag_load_news_by_category&category_id=${x}&paged=${t}&posts_per_page=${s}&nonce=${ajax_object.nonce}`).then(n=>{const a=document.createElement("div");a.innerHTML=n;const o=a.querySelectorAll(".archive-news__item");e?o.forEach(r=>d.appendChild(r)):(d.innerHTML="",o.forEach(r=>d.appendChild(r))),o.length<s?f=!1:f=!0}).catch(n=>{console.error("Ошибка подгрузки новостей:",n)}).finally(()=>{h&&(h.style.display="none"),p=!1})}function R(){E||(E=setTimeout(()=>{if(E=null,p||!f)return;const e=d.getBoundingClientRect().bottom,n=window.innerHeight+500;e<=n&&(q++,z(q,!0))},200))}function O(){v.length>0&&d&&v.forEach(t=>{t.addEventListener("click",function(){if(this.disabled||this.classList.contains("archive-tabs__item--active"))return;const s=this.getAttribute("data-category");x=s,q=1,f=!0,v.forEach(n=>{n.classList.remove("archive-tabs__item--active"),n.disabled=!0}),this.classList.add("archive-tabs__item--active"),h&&(h.style.display=""),k(ajax_object.ajaxurl,`action=khag_load_news_by_category&category_id=${s}&paged=1&posts_per_page=${S}&nonce=${ajax_object.nonce}`).then(n=>{const a=document.createElement("div");a.innerHTML=n;const o=a.querySelectorAll(".archive-news__item");d.innerHTML="",o.forEach(r=>d.appendChild(r)),o.length<S?f=!1:f=!0}).catch(n=>{console.error("Ошибка загрузки новостей по категории:",n)}).finally(()=>{h&&(h.style.display="none"),v.forEach(n=>n.disabled=!1)})})})}d&&(d.querySelectorAll(".archive-news__item").length<S&&(f=!1),initialLoadComplete=!0,O(),window.addEventListener("scroll",R));const g=document.querySelector("#magazine-items-container"),_=document.querySelector("#magazine-pagination-container"),y=document.getElementById("news-loader");let w=!1;function K(t=1){w||(w=!0,y&&(y.style.display=""),k(ajax_object.ajaxurl,`action=khag_load_magazines&paged=${t}&nonce=${ajax_object.nonce}`).then(e=>{if(g){const s=document.createElement("div");s.innerHTML=e;const n=s.querySelectorAll(".journal-section__item"),a=g.querySelectorAll(".journal-section__item");a.forEach((i,l)=>{l<a.length-1&&i.remove()});const o=g.querySelector(".journal-section__item:last-child");n.forEach(i=>{o?o.insertAdjacentElement("beforebegin",i):g.appendChild(i)});const r=s.querySelector(".pagination");_&&(_.innerHTML="",r&&_.appendChild(r)),A();const c=document.querySelector(".journal-section--archive");c&&c.scrollIntoView({behavior:"smooth",block:"start"})}}).catch(e=>{console.error("Ошибка загрузки журналов:",e)}).finally(()=>{y&&(y.style.display="none"),w=!1}))}function A(){if(!_)return;_.querySelectorAll(".pagination__item a").forEach(e=>{e.addEventListener("click",function(s){s.preventDefault();const n=parseInt(this.getAttribute("data-page"));n&&K(n)})})}if(g&&_){const t=g.querySelector(".pagination");t&&_.appendChild(t),A()}const U=function(){const t=document.querySelectorAll(".subscribe-block__form, .widget-subscribe__form"),e=document.getElementById("subscribe-message"),s=e?e.querySelector(".subscribe-block__message-title"):null,n=e?e.querySelector(".subscribe-block__message-text"):null,a=document.getElementById("subscribe-message-close");if(!t.length||!e||!s||!n)return;const o=function(){e.classList.remove("subscribe-block__message--visible")};a&&a.addEventListener("click",o),document.addEventListener("keydown",function(c){c.key==="Escape"&&o()});const r=function(c){const i=c.title,l=c.text,u=c.isSuccess;s.textContent=i,n.textContent=l,e.classList.remove("subscribe-block__message--success","subscribe-block__message--error","subscribe-block__message--visible"),e.classList.add(u?"subscribe-block__message--success":"subscribe-block__message--error","subscribe-block__message--visible"),setTimeout(o,3500)};t.forEach(function(c){c.addEventListener("submit",function(i){i.preventDefault();const l=new FormData(c),u=c.querySelector('input[name="subscribe_nonce"]'),m=u?u.value:"",I=l.get("subscribe_hp")||"";fetch(ajax_object.ajaxurl,{method:"POST",body:new URLSearchParams({action:"subscribe_user",name:l.get("name")||"",email:l.get("email")||"",nonce:m,subscribe_hp:I})}).then(function(b){return b.json()}).then(function(b){r({title:b.success?"Подписка успешно оформлена!":"Ошибка",text:b.data||(b.success?"Спасибо за подписку!":"Попробуйте повторить позднее."),isSuccess:!!b.success}),b.success&&c.reset()}).catch(function(){r({title:"Ошибка",text:"Не удалось отправить форму. Попробуйте ещё раз позже.",isSuccess:!1})})})})};document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector(".overlay");document.addEventListener("wpcf7mailsent",function(e){e.target.reset()},!1);try{D(".archive-tabs__wrapper",".archive-tabs__item",".js-tabs-content")}catch{}try{H()}catch{}try{M()}catch{}try{P(t)}catch{}try{U()}catch{}});
