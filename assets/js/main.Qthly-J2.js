const I=t=>{const e=document.body,s=document.querySelector(".header__burger"),n=document.querySelector(".header__center"),a=n.querySelectorAll(".header__nav a"),o=document.querySelector(".header__mobile-close");function i(){n.classList.add("header__center--active"),e.classList.add("body-active"),t.classList.add("overlay--active")}function c(){n.classList.remove("header__center--active"),e.classList.remove("body-active"),t.classList.remove("overlay--active")}s.addEventListener("click",()=>{i()}),o.addEventListener("click",()=>{c()}),t.addEventListener("click",()=>{c()}),a.forEach(r=>{r.addEventListener("click",()=>{c()})})},P=()=>{const t=document.querySelectorAll(".js-search-toggle"),e=document.querySelector(".header__search-bar"),s=document.querySelector(".header__search-input"),n=document.querySelector(".header__search-close");if(t.length===0||!e)return;function a(){t.forEach(i=>{i.classList.toggle("header__info-search--active")}),e.classList.toggle("header__search-bar--active")}function o(){t.forEach(i=>{i.classList.remove("header__info-search--active")}),e.classList.remove("header__search-bar--active"),s&&(s.value="")}t.forEach(i=>{i.addEventListener("click",c=>{c.preventDefault(),a(),setTimeout(()=>{s&&s.focus()},400)})}),n&&n.addEventListener("click",i=>{i.preventDefault(),o()})};function M(t){const e=document.querySelector(".archive-tabs__item--active"),s=document.querySelector(".archive-tabs");if(!e||!s||t.length===0)return;const n=t[0],a=t[t.length-1];s.classList.remove("has-active-first","has-active-last"),e===n?s.classList.add("has-active-first"):e===a&&s.classList.add("has-active-last")}function j(t,e){t.forEach(s=>s.classList.remove("archive-tabs__item--active")),e&&e.classList.add("archive-tabs__item--active"),M(t)}function L(t,e=0){t[e].classList.add("js-tabs-content--active")}function T(t){t.forEach(e=>{e.classList.remove("js-tabs-content--active")})}const $=(t,e,s)=>{const n=document.querySelector(t),a=document.querySelectorAll(e),o=document.querySelectorAll(s);o.length!==0&&L(o,0),n.addEventListener("click",i=>{i.preventDefault();const c=i.target;c&&c.classList.contains(e.substring(1))&&a.forEach((r,l)=>{if(c===r){if(j(a,a[l]),o.length===0)return;T(o),L(o,l)}})})},D=()=>{const t=document.querySelectorAll(".archive-tabs__item"),e={"О журнале":".info-section",Архив:".journal-section--archive",Реклама:".info-section--ads",Подписка:".info-section--subscribe"},s={about:"О журнале",archive:"Архив",ads:"Реклама",subscribe:"Подписка"},n={"О журнале":"about",Архив:"archive",Реклама:"ads",Подписка:"subscribe"},a=Object.values(e).map(c=>document.querySelector(c)),o=c=>{const r=Array.from(t).findIndex(l=>l.textContent.trim()===c);r!==-1&&(j(t,t[r]),T(a),a[r]&&L(a,r))};if(t.length>0){const r=new URLSearchParams(window.location.search).get("tab");r&&s[r]?(o(s[r]),setTimeout(()=>{const l=document.querySelector(".archive-tabs");l&&l.scrollIntoView({behavior:"smooth",block:"start"})},100)):a.forEach((l,u)=>{l&&u===0&&L(a,0)})}document.querySelectorAll(".footer__nav-list li a").forEach(c=>{const r=c.textContent.trim();if(n[r]){const l=`${window.location.origin}/about/?tab=${n[r]}`;c.setAttribute("href",l),c.addEventListener("click",u=>{if(u.ctrlKey||u.metaKey||u.shiftKey||u.button===1)return;const v=document.querySelector(".archive-tabs--journal");v&&t.length>0&&(u.preventDefault(),o(r),setTimeout(()=>{v.scrollIntoView({behavior:"smooth",block:"start"})},100))})}})},k=async(t,e)=>await(await fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e})).text(),g=document.querySelectorAll(".archive-tabs__item"),d=document.getElementById("news-container"),h=document.getElementById("news-loader");let q=1,C="all";const S=10,H=5;let p=!1,f=!0,E=null;function B(t=1,e=!1){if(p||!f&&e)return;p=!0,h&&(h.style.display="");const s=t===1?S:H;k(ajax_object.ajaxurl,`action=khag_load_news_by_category&category_id=${C}&paged=${t}&posts_per_page=${s}&nonce=${ajax_object.nonce}`).then(n=>{const a=document.createElement("div");a.innerHTML=n;const o=a.querySelectorAll(".archive-news__item");e?o.forEach(i=>d.appendChild(i)):(d.innerHTML="",o.forEach(i=>d.appendChild(i))),o.length<s?f=!1:f=!0}).catch(n=>{console.error("Ошибка подгрузки новостей:",n)}).finally(()=>{h&&(h.style.display="none"),p=!1})}function z(){E||(E=setTimeout(()=>{if(E=null,p||!f)return;const e=d.getBoundingClientRect().bottom,n=window.innerHeight+500;e<=n&&(q++,B(q,!0))},200))}function R(){g.length>0&&d&&g.forEach(t=>{t.addEventListener("click",function(){if(this.disabled||this.classList.contains("archive-tabs__item--active"))return;const s=this.getAttribute("data-category");C=s,q=1,f=!0,g.forEach(n=>{n.classList.remove("archive-tabs__item--active"),n.disabled=!0}),this.classList.add("archive-tabs__item--active"),h&&(h.style.display=""),k(ajax_object.ajaxurl,`action=khag_load_news_by_category&category_id=${s}&paged=1&posts_per_page=${S}&nonce=${ajax_object.nonce}`).then(n=>{const a=document.createElement("div");a.innerHTML=n;const o=a.querySelectorAll(".archive-news__item");d.innerHTML="",o.forEach(i=>d.appendChild(i)),o.length<S?f=!1:f=!0}).catch(n=>{console.error("Ошибка загрузки новостей по категории:",n)}).finally(()=>{h&&(h.style.display="none"),g.forEach(n=>n.disabled=!1)})})})}d&&(d.querySelectorAll(".archive-news__item").length<S&&(f=!1),initialLoadComplete=!0,R(),window.addEventListener("scroll",z));const _=document.querySelector("#magazine-items-container"),b=document.querySelector("#magazine-pagination-container"),y=document.getElementById("news-loader");let w=!1;function O(t=1){w||(w=!0,y&&(y.style.display=""),k(ajax_object.ajaxurl,`action=khag_load_magazines&paged=${t}&nonce=${ajax_object.nonce}`).then(e=>{if(_){const s=document.createElement("div");s.innerHTML=e;const n=s.querySelectorAll(".journal-section__item"),a=_.querySelectorAll(".journal-section__item");a.forEach((r,l)=>{l<a.length-1&&r.remove()});const o=_.querySelector(".journal-section__item:last-child");n.forEach(r=>{o?o.insertAdjacentElement("beforebegin",r):_.appendChild(r)});const i=s.querySelector(".pagination");b&&(b.innerHTML="",i&&b.appendChild(i)),x();const c=document.querySelector(".journal-section--archive");c&&c.scrollIntoView({behavior:"smooth",block:"start"})}}).catch(e=>{console.error("Ошибка загрузки журналов:",e)}).finally(()=>{y&&(y.style.display="none"),w=!1}))}function x(){if(!b)return;b.querySelectorAll(".pagination__item a").forEach(e=>{e.addEventListener("click",function(s){s.preventDefault();const n=parseInt(this.getAttribute("data-page"));n&&O(n)})})}if(_&&b){const t=_.querySelector(".pagination");t&&b.appendChild(t),x()}const K=function(){const t=document.querySelectorAll(".subscribe-block__form, .widget-subscribe__form"),e=document.getElementById("subscribe-message"),s=e?e.querySelector(".subscribe-block__message-title"):null,n=e?e.querySelector(".subscribe-block__message-text"):null,a=document.getElementById("subscribe-message-close");if(!t.length||!e||!s||!n)return;const o=function(){e.classList.remove("subscribe-block__message--visible")};a&&a.addEventListener("click",o),document.addEventListener("keydown",function(c){c.key==="Escape"&&o()});const i=function(c){const r=c.title,l=c.text,u=c.isSuccess;s.textContent=r,n.textContent=l,e.classList.remove("subscribe-block__message--success","subscribe-block__message--error","subscribe-block__message--visible"),e.classList.add(u?"subscribe-block__message--success":"subscribe-block__message--error","subscribe-block__message--visible"),setTimeout(o,3500)};t.forEach(function(c){c.addEventListener("submit",function(r){r.preventDefault();const l=new FormData(c),u=c.querySelector('input[name="subscribe_nonce"]'),v=u?u.value:"",A=l.get("subscribe_hp")||"";fetch(ajax_object.ajaxurl,{method:"POST",body:new URLSearchParams({action:"subscribe_user",name:l.get("name")||"",email:l.get("email")||"",nonce:v,subscribe_hp:A})}).then(function(m){return m.json()}).then(function(m){i({title:m.success?"Подписка успешно оформлена!":"Ошибка",text:m.data||(m.success?"Спасибо за подписку!":"Попробуйте повторить позднее."),isSuccess:!!m.success}),m.success&&c.reset()}).catch(function(){i({title:"Ошибка",text:"Не удалось отправить форму. Попробуйте ещё раз позже.",isSuccess:!1})})})})};document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector(".overlay");document.addEventListener("wpcf7mailsent",function(e){e.target.reset()},!1);try{$(".archive-tabs__wrapper",".archive-tabs__item",".js-tabs-content")}catch{}try{D()}catch{}try{P()}catch{}try{I(t)}catch{}try{K()}catch{}});
